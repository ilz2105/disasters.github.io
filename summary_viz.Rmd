---
title: "Summary Visualizations"
output: 
  html_document:
    toc: false
    toc_float: false
    theme: flatly
---

```{r, echo = FALSE, warning= FALSE, message=FALSE}
library(tidyverse)
library(ggridges)
library(plotly)
```

## Plot Showing Average Temperatures by Region

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(rvest)

ave_temp = read_csv("https://www.ncdc.noaa.gov/cag/statewide/mapping/110-tavg.csv", skip = 3) %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month"), sep = 4) %>%
  mutate(
    year = as.numeric(year), 
    state_code = setNames(state.abb, state.name)[location]) %>% 
  filter(year >= 1953 & year <= 2018) %>% 
  group_by(location, year) %>% 
  mutate(
    mean_temp = mean(value)) %>% 
  select(state_code, location, year, mean_temp) %>% 
  distinct()

precip = read_csv("https://www.ncdc.noaa.gov/cag/statewide/mapping/110-pcp.csv", skip = 3) %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month"), sep = 4) %>%
 mutate(
    year = as.numeric(year), 
    state_code = setNames(state.abb, state.name)[location]) %>% 
  filter(year >= 1953 & year <= 2018) %>% 
  group_by(location, year) %>% 
  mutate(
    total_precip = sum(value)) %>% 
  select(state_code, location, year, total_precip) %>% 
  distinct()

tmax = read_csv("https://www.ncdc.noaa.gov/cag/statewide/mapping/110-tmax.csv", skip = 3) %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month"), sep = 4) %>%
 mutate(
    year = as.numeric(year), 
    state_code = setNames(state.abb, state.name)[location]) %>% 
  filter(year >= 1953 & year <= 2018) %>% 
  group_by(location, year) %>% 
  mutate(
    max_temp = max(value)) %>% 
  select(state_code, location, year, max_temp) %>% 
  distinct()

tmin = read_csv("https://www.ncdc.noaa.gov/cag/statewide/mapping/110-tmin.csv", skip = 3)  %>% 
  janitor::clean_names() %>% 
  separate(date, into = c("year", "month"), sep = 4) %>%
 mutate(
    year = as.numeric(year), 
    state_code = setNames(state.abb, state.name)[location]) %>% 
  filter(year >= 1953 & year <= 2018) %>% 
  group_by(location, year) %>% 
  mutate(
    min_temp = min(value)) %>% 
  select(state_code, location, year, min_temp) %>% 
  distinct()

disasters = read_csv("./data/DisasterDeclarationsSummaries2.csv") %>% 
  janitor::clean_names() %>% 
  mutate(disaster = factor(incident_type)) %>% 
  rename(
     year = fy_declared) %>% 
  filter(year >= 1953 & year <= 2018) %>% 
  count(state, year, disaster) %>%
  group_by(year, state) %>% 
  mutate(
    n_state = sum(n)
  ) %>% 
  group_by(year) %>% 
  mutate(
    n_total = sum(n)
  ) %>% 
  group_by(year, disaster) %>% 
  mutate(
    n_type = sum(n)
  ) %>% 
  rename("n_disaster_state" = "n") 

final_data = 
  inner_join(ave_temp, precip, by = c("location" = "location", "year" = "year", "state_code" = "state_code")) %>% 
  inner_join(tmax, by = c("location" = "location", "year" = "year", "state_code" = "state_code")) %>% 
  inner_join(tmin, by = c("location" = "location", "year" = "year", "state_code" = "state_code")) %>% 
  full_join(disasters, by = c("year" = "year", "state_code" = "state"))
```


```{r, echo = FALSE, warning= FALSE, message=FALSE}
final_data = final_data %>% 
mutate(
  region = case_when(
    location %in% c(
                    "Alabama","Arkansas","Delaware","Florida","Georgia"
                    ,"Kentucky","Louisiana","Maryland","Mississippi",
                    "Oklahoma","North Carolina","South Carolina",
                    "Tennessee","Texas","Virginia","West Virginia") ~ "southeast",
   location %in% c("Connecticut","Maine","New Hampshire","Massachusetts",
                   "New Jersey","New York","Pennsylvania","Rhode Island","Vermont") ~ 'northeast',
  location %in% c("Alaska", 
                "Arizona","California","Colorado","Hawaii","Idaho",
                "Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming")
       ~  'west',
  location %in% c("Illinois",
                "Indiana","Iowa","Kansas","Michigan","Missouri",
                "Minnesota","Nebraska","North Dakota","Ohio","South Dakota", "Wisconsin") ~ 'midwest'))

```


```{r, scatterplot, echo = FALSE, warning= FALSE, message=FALSE}

final_data %>% 
  drop_na() %>% 
  ggplot(aes(x = year, y = mean_temp, group = region, color = region))+
  geom_point(aes(color = region))+
  geom_smooth( se = FALSE)+
  labs(title = "Average Temps(F) by Region from 1953-2018", 
       xlab = "Year",
       ylab = "Average Temperature(F)")+
  theme_bw()+
  theme(legend.position = "left")
```


This scatterplot showed the average temperature (F) from 1953 to 2018, by region. Overall, the southeast region had the highest average temperatures and the Northeast had the lowest average temperatures. Though it may be hard to see,
the average temperature increased from 70.81F to 72.28F from 1953 to 2018 in Florida, 59.25F to 62.26F in Arizona, 
56.63F to 55.23F in Missouri, and 53.54F to 54.14F in New Jersey.The different colored lines show the average trend over the years for average temperature, for each region.


```{r, panel, echo = FALSE, warning= FALSE, message=FALSE}

final_data %>% 
  group_by( disaster, region)%>% 
  select(region, disaster, year, n_total)%>% 
  drop_na() %>% 
  filter(disaster == "Fire"| 
           disaster =="Hurricane"| 
           disaster =="Tornado"|
           disaster =="Earthquake") %>% 
  ggplot(aes(x = year, y = n_total, color = disaster)) +
  geom_line()+
  theme(aspect.ratio = 1, axis.text.x = element_text(angle = 90,  hjust = 1))+
  facet_wrap(~region)+
  labs(title = "",
       xlab = "Year",
       ylab = "Frequency of Disasters")
```

This panel shows the total number of earthquakes, fires, hurricanes, and tornadoes from 1953-2018 for each region. The disasters are shown in different colors. The Western region had no hurricanes while the other three regions did not have any earthquakes.  


## Plot showing total precipitation in inches for each region

```{r, echo = FALSE, warning= FALSE, message=FALSE}
final_data %>% 
  drop_na() %>% 
  select(region, year, total_precip) %>% 
  distinct() %>% 
  mutate(text_label = str_c( year, "\n", location)) %>% 
  plot_ly( x = ~region, y = ~total_precip, type = "bar",
    color = ~region, text = ~text_label, alpha = 0.5)

```

This plot showed the breakdown of the total precipitation amount by state for each year, and was split up into regions, with the total precipitation summed up for each region. The southeast had overall the most inches in precipitation, while the west had the least amount of precipitation. 

## Plot showing Total Number of Disasters by State from 1953-2018, Summed up for Each Region

```{r, echo = FALSE, warning= FALSE, message=FALSE}
 final_data %>% 
  drop_na() %>% 
  select(disaster, n_disaster_state, region) %>% 
  distinct() %>% 
  mutate(text_label = str_c(region, "\n", location, "\n")) %>%
  plot_ly(
    x = ~disaster, y = ~n_disaster_state, type = "bar", mode = "markers",
    color = ~region, text = ~text_label, alpha = 0.5)

```

This bar graph showed the total number of disasters for each region in the US, from 1953-2018. By hovering over the bars, you can see the individual number of disasters for each state. We observed that the southeast had the most hurricanes, while the midwest had a greater frequency of floods. 


## Boxplot showing the count of total disaster type by state


```{r, echo = FALSE, warning= FALSE, message=FALSE}
final_data %>% 
  drop_na() %>% 
  select(disaster, n_disaster_state, region) %>% 
  distinct() %>% 
  group_by(year, location, disaster) %>% 
mutate(text_label = str_c( disaster, "\n", location)) %>% 
  plot_ly(
    x = ~disaster, y = ~n_disaster_state, type = "box",
    color = ~disaster, text = ~text_label, alpha = 0.5)
```

This box plot showed the median, maximum, and minimum values for the count of total disasters, and it also showed the count of disaster type for each state. For example, for `hurricane`, the median was 18, maximum was 763, minimum was 1, and Louisiana had 161 hurricanes from 1953 to 2018. 









